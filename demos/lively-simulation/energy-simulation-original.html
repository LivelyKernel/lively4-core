<lively-simulation tabindex="0" data-velocity="10" data-stoponerror="false" data-time="100" data-dt="0.1"><lively-simulation-cell style="top: 799px; left: 39.7578px; width: 541.453px; height: 261.359px; z-index: 139;" data-name="ResetSimulation" data-state="{}" data-snippet="#Fuel.gas = 5 * 2 * 3600 // two hours gas
#HeatStorage.energy = 0
#Battery.energy = 0 
#ElectricConsumer.consumed = 0
#ElectricConsumer.demand = 1.5
#ElectricConsumer.extra = 0
#HeatConsumer.consumed = 0
#HeatConsumer.demand = 3
#HeatConsumer.extra = 0
#ThermalPowerStation.heat = 0
#HeatingSystem.heat = 0
#Battery.max = 0.1 * 3600 // 1h 2kw
#HeatStorage.max = 0.1 * 3600 // 1h 3kw" data-view="codeView" data-loginterval="1" data-lively-id="db4cfe19-7ed2-4d9b-9b2b-2aa517e80e5f" data-should-skip="true"></lively-simulation-cell><lively-simulation-cell style="top: 320px; left: 23.2561px; width: 246.35px; height: 148.399px; z-index: 135;" data-name="Fuel" data-state="{&quot;gas&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:35998.75}}" data-snippet="if (gas < 0) {
    throw Error(&quot;Gas Empty&quot;)
}" data-view="codeView" data-loginterval="1" data-lively-id="358a6017-4bb6-4d57-b998-4221423bfda2"><img src="https://image.flaticon.com/icons/svg/2362/2362783.svg" style="position: relative; width: 53px; height: 62px; left: 119px; top: 4px;" class="">
<div class="lively-text lively-content" contenteditable="true" style="width: 183px; position: absolute; left: 32px; top: -90px; height: 63px;">Click here to see all cell that require fuel, below is the log view of the same&nbsp;cell.<div>|</div></div></lively-simulation-cell><lively-simulation-cell style="top: 497px; left: 373px; width: 615.6px; height: 277.594px; z-index: 138;" data-name="Thermal Power Station" data-state="{&quot;heat&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0.75},&quot;factor&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:10},&quot;max&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:7.5}}" data-snippet="var full = max * factor;
if (heat < full &amp;&amp; #Fuel.gas > max * dt
    &amp;&amp; (#Battery.energy < 0.9 * #Battery.max )) {
    var gas = max * dt;
    #Fuel.gas -= gas;
    heat += 1.0 * gas
}
var delta = heat / factor * dt;
if (heat > 2) {
    heat -= delta;
    if(#HeatStorage.energy < #HeatStorage.max) {
        #HeatStorage.energy += 0.5 * delta;
    }
    if (#Battery.energy < #Battery.max ) {
        #Battery.energy += 0.4 * delta;
    }
}" data-view="codeView" data-loginterval="1" data-lively-id="c6eae5ef-cdc4-46df-9258-c0db109f88b8"><img src="https://image.flaticon.com/icons/svg/857/857761.svg" style="width: 75px;height: 58px;position: relative;left: 10px;top: 0px;"><img src="https://image.flaticon.com/icons/svg/2983/2983973.svg" style="width: 53px;height: 37px;position: absolute;left: 101px;top: 232px;"></lively-simulation-cell><lively-simulation-cell style="top: 79px; left: 374.242px; z-index: 137; width: 500px; height: 264.28px;" data-name="Heating System" data-state="{&quot;heat&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0.4995},&quot;factor&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:20},&quot;max&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:5}}" data-snippet="var full = max  * factor
if (heat < full &amp;&amp; #Fuel.gas > max * dt &amp;&amp;
    #HeatStorage.energy < 0.3 * #HeatStorage.max) {
    var gas = max * dt;
    #Fuel.gas -= gas;
    heat += gas;
}

var delta = (heat / factor) * dt;
if (heat > 2 * max  &amp;&amp; #HeatStorage.energy < #HeatStorage.max ) {
    heat -= delta;
    #HeatStorage.energy += 0.8 * delta;
} else {
    heat -= 0.2 * delta;
}" data-view="chartView" data-loginterval="1" data-lively-id="80937f3f-2786-45de-8691-c83825696023"><img src="https://image.flaticon.com/icons/svg/857/857761.svg" style="width: 75px; height: 58px; position: relative; left: -2px; top: -2px;">
<div class="lively-text lively-content" contenteditable="true" style="width: 300px; position: absolute; left: 143px; top: 216px;">A heating system requires fuel and produces heat</div></lively-simulation-cell><lively-simulation-cell style="top: 276px; left: 904.067px; z-index: 115; width: 284.115px; height: 74.4531px;" data-name="Heat Storage" data-state="{&quot;energy&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;max&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:360}}" data-snippet="// Enter simulation code here" data-view="codeView" data-loginterval="1" data-lively-id="79eca28f-b50d-49b9-9d0e-b426c590fb67">
<img src="https://image.flaticon.com/icons/svg/870/870620.svg" style="width: 28px;height: 44px;position: relative;left: 30px;top: 0;"></lively-simulation-cell><lively-simulation-cell style="top: 390px; left: 903.754px; z-index: 140; width: 346.609px; height: 200px;" data-name="Battery" data-state="{&quot;energy&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;max&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:360}}" data-snippet="" data-view="logView" data-loginterval="1" data-lively-id="15c89e50-98bf-4476-91fb-eec24c7173da"><img src="https://image.flaticon.com/icons/svg/3165/3165660.svg" style="width: 174px;height: 46px;position: relative;left: -36px;top: 0;"></lively-simulation-cell><lively-simulation-cell style="top: 58px; left: 1168.73px; z-index: 118; width: 468.533px; height: 200px; position: absolute;" data-name="Heat Consumer" data-state="{&quot;consumed&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;extra&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;demand&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:3}}" data-snippet="var delta = demand * dt
if (#HeatStorage.energy > delta) {
    #HeatStorage.energy -= delta
    consumed += delta
    // TODO consume Extra
} else {
    extra  +=  delta
    throw Error(&quot;RoomToCold&quot;)
}
" data-view="codeView" data-loginterval="1" data-lively-id="8c62075a-2da9-4c8a-b389-2db5668abc39"><img src="https://image.flaticon.com/icons/svg/1422/1422837.svg" style="width: 48px;height: 38px;position: relative;left: 71px;top: -3px;"></lively-simulation-cell><lively-simulation-cell style="top: 537px; left: 1170.93px; z-index: 127; width: 447.844px; height: 180px;" data-name="Electric Consumer" data-state="{&quot;consumed&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;extra&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;demand&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:1.5}}" data-snippet="demand += (Math.random() - 0.5) * 0.01 * dt
var delta = demand * dt
if (#Battery.energy > delta) {
    #Battery.energy -= delta
    consumed += delta
} else {
    extra += delta
    throw Error(&quot;EngeryToLow&quot;)
}
" data-view="codeView" data-loginterval="1" data-lively-id="5ee77098-fadb-4e95-9dea-1870e9af548a"><img src="https://image.flaticon.com/icons/svg/2910/2910875.svg" style="width: 137px;height: 59px;position: relative;left: 163px;top: 0;"></lively-simulation-cell><lively-simulation-cell style="z-index: 124; width: 648px; height: 288px; position: absolute; left: 992px; top: 801.762px;" data-name="LogÃ" data-state="{&quot;gas&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:35998.75},&quot;heat&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;battery&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;consumedPower&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;consumedHeat&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0},&quot;TWP&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0.75},&quot;HS&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:0.4995}}" data-snippet="gas = #Fuel.gas;
heat = #HeatStorage.energy;
battery = #Battery.energy;
consumedPower = #ElectricConsumer.consumed;
consumedHeat = #HeatConsumer.consumed;
TWP = #ThermalPowerStation.heat;
HS = #HeatingSystem.heat;" data-view="codeView" data-loginterval="1" data-lively-id="fa816673-8922-4034-96bb-39861f2348af" class="lively-content"></lively-simulation-cell><lively-simulation-cell style="top: 478px; left: 23.2383px; width: 246.35px; height: 148.399px; z-index: 134;" data-name="Fuel" data-state="{&quot;gas&quot;:{&quot;unit&quot;:&quot;&quot;,&quot;value&quot;:35998.75}}" data-snippet="if (gas < 0) {
    throw Error(&quot;Gas Empty&quot;)
}" data-view="logView" data-loginterval="1" data-lively-id="358a6017-4bb6-4d57-b998-4221423bfda2" data-is-mirror="true" data-should-skip="true"></lively-simulation-cell></lively-simulation>